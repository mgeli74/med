{% extends 'store/base.html' %}
{% load static %}

{% block css %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const likeButtons = document.querySelectorAll('.like-btn');
    const dislikeButtons = document.querySelectorAll('.dislike-btn');

    likeButtons.forEach(button => {
        button.addEventListener('click', function() {
            const newsId = this.getAttribute('data-news-id');
            const value = this.getAttribute('data-value');
            vote(newsId, value);
        });
    });

    dislikeButtons.forEach(button => {
        button.addEventListener('click', function() {
            const newsId = this.getAttribute('data-news-id');
            const value = this.getAttribute('data-value');
            vote(newsId, value);
        });
    });

    function vote(newsId, value) {
        fetch(`/events/news/${newsId}/vote/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': '{{ csrf_token }}',  // –î–æ–±–∞–≤—å—Ç–µ CSRF-—Ç–æ–∫–µ–Ω –¥–ª—è –∑–∞—â–∏—Ç—ã
            },
            body: `value=${value}`
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert(data.error);
            } else {
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∞–π–∫–æ–≤ –∏ –¥–∏–∑–ª–∞–π–∫–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                document.getElementById('likes-count').textContent = data.likes;
                document.getElementById('dislikes-count').textContent = data.dislikes;
            }
        })
        .catch(error => console.error('Error:', error));
    }
});
</script>

    <link href="{% static 'css/posts.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
    <div class="container">
        <div class="row">
            
                <div class="col-lg-3">
                    <h3 class="my-4 text-white">{{ news.title }}:</h3>
                    <div class="list-group">
                        <a href="{% url 'news:events' %}" class="list-group-item back-button">‚Üê –õ–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π</a>
                    </div>
                </div>
            

            <div class="col-lg-9">
                <div class="card mb-4" style="background-color: rgba(0, 0, 0, 0.5); border: none;">
                    <div class="card-body text-white">
                        
                            <a href="#">
                                <img class="card-img-top" src="{{ news.image.url }}" alt="{{ news.name }}">
                            </a>
                            <p>{{ news.content }}</p>
                            <p>{{ news.fulltext }}</p>
                            <p>{{ news.data }}</p>
                        
                        {% csrf_token %}
                        <div class="row">
						    <div class="col-lg-12">
						        <h3 class="my-4 text-white">–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ:</h3>
						        <div class="voting">
                                    <button class="btn btn-outline-success like-btn" data-news-id="{{ news.id }}" data-value="1">
                                        üëç <span id="likes-count">{{ likes }}</span>
                                    </button>
                                    <button class="btn btn-outline-danger dislike-btn" data-news-id="{{ news.id }}" data-value="-1">
                                        üëé <span id="dislikes-count">{{ dislikes }}</span>
                                    </button>
                                </div>
						    </div>
						</div>
                    </div>

                   
<!-- –ë–ª–æ–∫ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ -->
<div class="row">
    <div class="col-lg-12">
        <h3 class="my-4 text-white">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</h3>
        <div class="comments-container">
            {% for comment in comments %}
                <div class="comment-card">
                    <div class="card-body text-white d-flex">
                        <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –∞–≤–∞—Ç–∞—Ä–∫–∞ –∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                        <div class="d-flex flex-column align-items-center me-3">
                            <!-- –ê–≤–∞—Ç–∞—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                            <div class="avatar-container mb-2">
                                <img width="100" height="100"
                                     src="{% if comment.author.image %} {{ comment.author.image.url }} {% else %} {% static 'img/users/default_avatar.jpg' %} {% endif %}"
                                     class="img-thumbnail">
                            </div>
                            <!-- –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                            <strong>{{ comment.author.username }}</strong>
                        </div>
                        <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: —Ç–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∏ –¥–∞—Ç–∞ -->
                        <div class="comment-text">
                            <p>{{ comment.text }}</p>
                            <div class="comment-date">
                                <small>{{ comment.created_date }}</small>
                            </div>
                        </div>
                    </div>
                </div>
            {% empty %}
                <p class="text-white">–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.</p>
            {% endfor %}
        </div>
    </div>
</div>
					            
                    <!-- –§–æ—Ä–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
                    {% if user.is_authenticated %}
                        <div class="row">
                            <div class="col-lg-12">
                                <h3 class="my-4 text-white">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</h3>
                                <form method="post" action="{% url 'news:post' post_id=news.id %}">
                                    {% csrf_token %}
                                    <div class="form-group">
                                        <textarea 
                                            class="form-control comment-input" 
                                            name="text" 
                                            rows="3" 
                                            placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..."
                                            required
                                        ></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                                </form>
                            </div>
                        </div>
                    {% else %}
                        <div class="row">
                            <div class="col-lg-12">
                                <p class="text-white">–ß—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, <a href="{% url 'users:login' %}">–≤–æ–π–¥–∏—Ç–µ</a> –∏–ª–∏ <a href="{% url 'users:registration' %}">–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</a>.</p>
                            </div>
                        </div>
                    {% endif %}
                </div>

                <!-- –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —á–µ—Ä–Ω—ã–π –ø–∞–≥–∏–Ω–∞—Ç–æ—Ä -->
                <nav aria-label="Page navigation example">
                    <ul clusers:ass="pagination justify-content-center" style="background-color: rgba(0, 0, 0, 0.5); padding: 10px; border-radius: 5px;">
                        <li class="page-item {% if not events.has_previous %} disabled {% endif %}">
                            <a class="page-link text-white" style="background-color: transparent; border: 1px solid rgba(255, 255, 255, 0.2);"
                               href="{% if events.has_previous %} {% url 'news:paginator' events.previous_page_number %} {% else %} # {% endif %}"
                               tabindex="-1" aria-disabled="true">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
                        </li>
                        {% for page in events.paginator.page_range %}
                            <li class="page-item">
                                <a class="page-link text-white" style="background-color: transparent; border: 1px solid rgba(255, 255, 255, 0.2);"
                                   href="{% url 'news:paginator' page %}">
                                    {{ page }}
                                </a>
                            </li>
                        {% endfor %}
                        <li class="page-item {% if not events.has_next %} disabled {% endif %}">
                            <a class="page-link text-white" style="background-color: transparent; border: 1px solid rgba(255, 255, 255, 0.2);"
                               href="{% if events.has_next %} {% url 'news:paginator' events.next_page_number %} {% else %} # {% endif %}">
                                –°–ª–µ–¥—É—é—â–∞—è
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
{% endblock %}


{% block footer %}
    <footer class="py-5" style="background-color: rgba(0, 0, 0, 0.5);">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 col-md-6 mb-4">
                    <h5 class="text-white">–û –Ω–∞—Å</h5>
                    <p class="text-white-50">–ú—ã ‚Äî –∫–æ–º–∞–Ω–¥–∞ "–ú–µ–¥–æ–µ–¥—ã", —Å–æ–∑–¥–∞—é—â–∞—è –ª—É—á—à–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã –¥–ª—è –≤–∞—Å.</p>
                </div>
                <div class="col-lg-4 col-md-6 mb-4">
                    <h5 class="text-white">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-white-50">Email: info@medoedy.com</a></li>
                        <li><a href="#" class="text-white-50">–¢–µ–ª–µ—Ñ–æ–Ω: +7 (123) 456-78-90</a></li>
                    </ul>
                </div>
                <div class="col-lg-4 col-md-6 mb-4">
                    <h5 class="text-white">–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-white-50">VK</a></li>
                        <li><a href="#" class="text-white-50">Telegram</a></li>
                        <li><a href="#" class="text-white-50">Instagram</a></li>
                    </ul>
                </div>
            </div>
            <div class="text-center">
                <p class="m-0 text-white-50">–ú–µ–¥–æ–µ–¥—ã &copy; Team 2022</p>
            </div>
        </div>
    </footer>
{% endblock %}





